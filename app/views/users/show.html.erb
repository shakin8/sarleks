<% provide(:title, @user.name) %>
<div class="spacer-medium"></div>
<div class="main">
  <section class="portfolios">
    <h3 class="pad-top-bottom-small">TAKE A LOOK AT <%= @user.username.upcase %>'S LATEST PORTFOLIOS!</h3>
    <p>
      <tr>
        <% @portfolios.first(3).each do |portfolio| %>
          <% portfolio.collections.first(1).each do |collection| %>
            <% collection.pieces.first(1).each do |piece| %>
              <td>
                <% unless piece.images.first.nil? %>
                  <div class="thumbnail">
                  <%= link_to image_tag(piece.images[rand(piece.images.length)].image_url(:thumb).to_s), user_portfolio_path({user_id: @user.permalink, id: portfolio.id}) %>
                  </div>
                <% end %>
              </td>
            <% end %> 
          <% end %>
        <% end %>
      </tr>
    </p><br/>
    <p><%= link_to "View More Portfolios From #{@user.username.upcase} >>", user_portfolios_path(@user) %></p><br/>
  </section>
  
  <div class="spacer-small"></div>

  <section class="collections">
    <h3 class="pad-top-bottom-small">TAKE A LOOK AT <%= @user.username.upcase %>'S LATEST COLLECTIONS!</h3>
    <p>
      <tr>
        <% @collections.first(3).each do |collection| %>
          <% collection.pieces.first(1).each do |piece| %>
            <td>
              <% unless piece.images.first.nil? %>
                <div class="thumbnail">
                <%= link_to image_tag(piece.images[rand(piece.images.length)].image_url(:thumb).to_s), user_collection_path({user_id: @user.permalink, id: collection.id}) %>
                </div>
              <% end %>
            </td>
          <% end %> 
        <% end %>
      </tr>
    </p><br/><div class="clear"></div>
    
    <p><%= link_to "View More Collections From #{@user.username.upcase} >>", user_collections_path(@user) %></p><br/>
  </section>  
  
  <div class="spacer-small"></div>

  <section class="pieces">
    <h3 class="pad-top-bottom-small">TAKE A LOOK AT <%= @user.username.upcase %>'S LATEST PIECES!</h3>
    <p>
      <tr><% @pieces.first(3).each do |piece| %>
        <td>
          <% unless piece.images.first.nil? %>
            <div class="thumbnail">
            <%= image_tag(piece.images.first.image_url(:thumb).to_s) %>
            </div>
          <% end %>
        </td>
      <% end %>
      </tr><br/>
    </p><br/><div class="clear"></div> 
    <p><%= link_to "View More Pieces From #{@user.username.upcase} >>", user_pieces_path(@user) %></p><br/>
  </section>  
  
  <div class="spacer-small"></div>

  <section class="activity">
    <% if @user.microposts.any? %>
      <h3>Activity (<%= @user.microposts.count %>)</h3>
      <ol class="microposts">
        <% if current_user?(@user) %>
          <%= render 'shared/feed' %>
        <% else %>
          <%= render @microposts %>
        <% end %>
      </ol>
      <%= will_paginate @microposts %>
    <% end %>
  </section>  
</div>

<aside class="power-column">
  <section class="user">
    <%= gravatar_for @user %>
    <h3><%= @user.name %></h3>
    <%= render 'shared/stats' %>
    <%= render 'follow_form' if signed_in? %>
  </section>
  <section>
    <ul>
      <li><%= link_to "Create new Portfolio", new_user_portfolio_path(@user)%></li>
      <li><%= link_to "Create new collection", new_user_collection_path(@user) %></li>
      <li><%= link_to "Create new piece", new_user_piece_path(@user) %></li>
    </ul>
  </section>
  <section>
    <p>Hello world this is a sentence designed to prove the wrapping of text in the small hero bar at the right hand side of the page. Let's see how it performs.</p>
  </section>
  <% if current_user?(@user) %>
    <section class="activity-form">
      <%= render 'shared/micropost_form' %>
    </section>
  <% end %>
  <section>
    <ul><%= render @microposts %></ul>
  </section>
</aside>
